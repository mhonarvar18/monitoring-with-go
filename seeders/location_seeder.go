package seeders

import (
	"context"
	"log"
	"monitoring-with-go/models"
	"github.com/google/uuid"
	"gorm.io/gorm"
)

type LocationType string

const (
	LocationCountry LocationType = "COUNTRY"
	LocationState   LocationType = "STATE"
	LocationCity    LocationType = "CITY"
)

func SeedLocations(db *gorm.DB) {

	var cnt int64
	if err := db.Model(&models.Location{}).Count(&cnt).Error; err != nil {
		log.Fatalf("count Location: %v", err)
	}

	// اگر جدول دارای داده باشد، از seeding و migration جلوگیری کنیم
	if cnt > 0 {
		log.Println("ℹ️ Location already seeded; skipping.")
		return
	}

	ctx := context.Background()

	if err := db.WithContext(ctx).AutoMigrate(&models.Location{}); err != nil {
		log.Fatalf("migrate Location: %v", err)
	}

	// 1) کشور
	iran := models.Location{ID: uuid.NewString(), Type: "COUNTRY", Label: "ایران"}
	{
		var existed models.Location
		tx := db.Where("label = ? AND type = ? AND parentId IS NULL", iran.Label, iran.Type).First(&existed)
		if tx.Error == gorm.ErrRecordNotFound {
			if err := db.Create(&iran).Error; err != nil {
				log.Fatalf("create country: %v", err)
			}
		} else if tx.Error != nil {
			log.Fatalf("find country: %v", tx.Error)
		} else {
			iran = existed
		}
	}

	// 2) استان‌ها + شهرها
	provinces := map[string][]string{
		"استان تهران":         {"تهران", "اسلامشهر", "شهریار", "شهر ری", "ورامین", "رودهن", "بومهن", "دماوند", "آبعلی", "پاکدشت", "فشم", "پردیس", "ارجمند", "اندیشه", "آبسرد", "باغستان", "باقرشهر", "پیشوا", "جوادآباد", "چهاردانگه", "حسن آباد", "دیزین", "رباط کریم", "شاهدشهر", "شریف آباد", "شمشک", "صالح آباد", "صباشهر", "صفادشت", "فردوسیه", "فیروزکوه", "قدس", "قرچک", "کهریزک", "کیلان", "گلستان", "لواسان", "ملارد", "میگون", "نسیم شهر", "نصیرآباد", "وحیدیه", "قیامدشت", "پرند"},
		"اصفهان":              {"اصفهان", "کاشان", "خمینی شهر", "نجف آباد", "شاهین شهر", "نطنز", "خوانسار", "ابوزیدآباد", "اردستان", "اژیه", "افوس", "انارک", "ایمانشهر", "آران وبیدگل", "بادرود", "باغ بهادران", "بافران", "برزک", "برف انبار", "بهاران شهر", "بهارستان", "بوئین و میاندشت", "پیربکران", "تودشک", "تیران", "جندق", "جوزدان", "جوشقان و کامو", "چادگان", "چرمهین", "چمگردان", "حبیب آباد", "حسن آباد", "حنا", "خالدآباد", "خور", "خورزوق", "داران", "دامنه", "درچه", "دستگرد", "دهاقان", "دهق", "دولت آباد", "دیزیچه", "رزوه", "رضوانشهر", "زاینده رود", "زرین شهر", "زواره", "زیباشهر", "سده لنجان", "سفیدشهر", "سگزی", "سمیرم", "شهرضا", "طالخونچه", "عسگران", "علویجه", "فرخی", "فریدونشهر", "فلاورجان", "فولادشهر", "قمصر", "قهجاورستان", "قهدریجان", "کرکوند", "کلیشاد و سودرجان", "کمشچه", "کمه", "کهریزسنگ", "کوشک", "کوهپایه", "گرگاب", "گزبرخوار", "گلپایگان", "گلدشت", "گلشهر", "گوگد", "لای بید", "مبارکه", "مجلسی", "محمدآباد", "مشکات", "منظریه", "مهاباد", "میمه", "نائین", "نصرآباد", "نوش آباد", "نیاسر", "نیک آباد", "هرند", "ورزنه", "ورنامخواست", "وزوان", "ونک", "ابریشم"},
		"خراسان رضوی":         {"مشهد", "نیشابور", "سبزوار", "تربت حیدریه", "کاشمر", "گناباد", "احمدآباد صولت", "انابد", "باجگیران", "باخرز", "بار", "بایگ", "بینالود", "بجستان", "بردسکن", "بیدخت", "تایباد", "تربت جام", "جغتای", "گلبهار", "جنگل", "چاپشلو", "چکنه", "چناران", "خرو", "خلیل آباد", "خواف", "داورزن", "درگز", "در رود", "دولت آباد", "رباط سنگ", "رشتخوار", "رضویه", "روداب", "ریوش", "سرخس", "سفیدسنگ", "سلامی", "سلطان آباد", "سنگان", "شادمهر", "شاندیز", "ششتمد", "شهرآباد", "شهرزو", "صالح آباد", "طرقبه", "عشق آباد", "فرهادگرد", "فریمان", "فیروزه", "فیض آباد", "قاسم آباد", "قدمگاه", "قلندرآباد", "قوچان", "کاخک", "کاریز", "کدکن", "کلات", "کندر", "گلمکان", "لطف آباد", "مزدآوند", "ملک آباد", "نشتیفان", "نصرآباد", "نقاب", "نوخندان", "نیل شهر", "همت آباد", "یونسی"},
		"فارس":                {"شیراز", "مرودشت", "جهرم", "فسا", "کازرون", "اردکان", "ارسنجان", "استهبان", "اشکنان", "افزر", "اقلید", "امام شهر", "اهل", "اوز", "ایج", "ایزدخواست", "آباده", "آباده طشک", "باب انار", "بالاده", "بنارویه", "بهمن", "بوانات", "بیرم", "بیضا", "جنت شهر", "جویم", "زرین دشت", "حسن آباد", "خان زنیان", "خاوران", "خرامه", "خشت", "خنج", "خور", "داراب", "داریان", "دبیران", "دژکرد", "دهرم", "دوبرجی", "رامجرد", "رونیز", "زاهدشهر", "زرقان", "سده", "سروستان", "سعادت شهر", "سورمق", "سیدان", "ششده", "شهرپیر", "شهرصدرا", "صغاد", "صفاشهر", "علامرودشت", "فدامی", "فراشبند", "فیروزآباد", "قائمیه", "قادرآباد", "قطب آباد", "قطرویه", "قیر", "کارزین (فتح آباد)", "کامفیروز", "کره ای", "کنارتخته", "کوار", "گراش", "گله دار", "لار", "لامرد", "لپویی", "لطیفی", "مبارک آباددیز", "مشکان", "مصیری", "مهر", "میمند", "نوبندگان", "نوجین", "نودان", "نورآباد", "نی ریز", "وراوی"},
		"آذربایجان شرقی":      {"تبریز", "مراغه", "مرند", "اهر", "میانه", "اسکو", "ایلخچی", "آذرشهر", "آقکند", "باسمنج", "بخشایش", "بستان آباد", "بناب", "بناب جدید", "ترک", "ترکمانچای", "تسوج", "تیکمه داش", "جلفا", "خاروانا", "خامنه", "خراجو", "خسروشهر", "خضرلو", "خمارلو", "خواجه", "دوزدوزان", "زرنق", "زنوز", "سراب", "سردرود", "سهند", "سیس", "سیه رود", "شبستر", "آبش احمد", "شربیان", "شرفخانه", "شندآباد", "صوفیان", "عجب شیر", "قره آغاج", "کشکسرای", "کلوانق", "کلیبر", "کوزه کنان", "گوگان", "لیلان", "ملکان", "ملک کیان", "ممقان", "مهربان", "نظرکهریزی", "هادی شهر", "هرگلان", "هریس", "هشترود", "هوراند", "وایقان", "ورزقان", "یامچی"},
		"آذربایجان غربی":      {"ارومیه", "خوی", "بوکان", "مهاباد", "میاندوآب", "اشنویه", "ایواوغلی", "آواجیق", "باروق", "بازرگان", "پلدشت", "پیرانشهر", "تازه شهر", "تکاب", "چهاربرج", "دیزج دیز", "ربط", "سردشت", "سرو", "سلماس", "سیلوانه", "سیمینه", "سیه چشمه", "شاهین دژ", "شوط", "فیرورق", "قره ضیاءالدین", "قطور", "قوشچی", "کشاورز", "گردکشانه", "ماکو", "محمدیار", "محمودآباد", "میرآباد", "نالوس", "نقده", "نوشین"},
		"مازندران":            {"ساری", "بابل", "آمل", "قائم شهر", "بهشهر", "بابلسر", "امیرکلا", "ایزدشهر", "آلاشت", "بلده", "بهنمیر", "پل سفید", "تنکابن", "جویبار", "چالوس", "چمستان", "خرم آباد", "خلیل شهر", "خوش رودپی", "دابودشت", "رامسر", "رستمکلا", "رویان", "رینه", "زرگرمحله", "زیرآب", "سرخرود", "سلمان شهر", "سورک", "شیرگاه", "شیرود", "عباس آباد", "فریدونکنار", "فریم", "کتالم", "کلارآباد", "کلاردشت", "کله بست", "کوهی خیل", "کیاسر", "کیاکلا", "گتاب", "گزنک", "گلوگاه", "محمودآباد", "مرزن آباد", "مرزیکلا", "نشتارود", "نکا", "نور", "نوشهر"},
		"گیلان":               {"رشت", "بندرانزلی", "لاهیجان", "لنگرود", "تالش", "احمدسرگوراب", "اسالم", "اطاقور", "املش", "آستارا", "آستانه اشرفیه", "بازار جمعه", "بره سر", "پره سر", "توتکابن", "جیرنده", "چابکسر", "چاف و چمخاله", "چوبر", "حویق", "خشکبیجار", "خمام", "دیلمان", "رانکوه", "رحیم آباد", "رستم آباد", "رضوانشهر", "رودبار", "رودبنه", "رودسر", "سنگر", "سیاهکل", "شفت", "شلمان", "صومعه سرا", "فومن", "کلاچای", "کوچصفهان", "کومله", "کیاشهر", "گوراب زرمیخ", "لشت نشا", "لوشان", "لولمان", "لوندویل", "لیسار", "ماسال", "ماسوله", "مرجقل", "منجیل", "واجارگاه", "زیباکنار", "پیربازار"},
		"خراسان شمالی":        {"بجنورد", "شیروان", "اسفراین", "آشخانه", "جاجرم", "ایور", "پیش قلعه", "تیتکانلو", "حصارگرمخان", "درق", "راز", "سنخواست", "شوقان", "صفی آباد", "فاروج", "قاضی", "گرمه", "لوجلی"},
		"خراسان جنوبی":        {"بیرجند", "قاین", "طبس ", "فردوس", "نهبندان", "ارسک", "اسدیه", "اسفدن", "اسلامیه", "آرین شهر", "آیسک", "بشرویه", "حاجی آباد", "خضری دشت بیاض", "خوسف", "زهان", "سرایان", "سربیشه", "سه قلعه", "شوسف", "قهستان", "محمدشهر", "مود", "نیمبلوک"},
		"خوزستان":             {"اهواز", "دزفول", "آبادان", "بندرماهشهر", "اندیمشک", "خرمشهر", "بندرامام خمینی", "اروندکنار", "الوان", "امیدیه", "ایذه", "آغاجاری", "باغ ملک", "بستان", "بهبهان", "ترکالکی", "جایزان", "چمران", "چویبده", "حر", "حسینیه", "حمزه", "حمیدیه", "دارخوین", "دزآب", "دهدز", "رامشیر", "رامهرمز", "رفیع", "زهره", "سالند", "سردشت", "سوسنگرد", "شادگان", "شاوور", "شرافت", "شوش", "شوشتر", "شیبان", "صالح شهر", "صفی آباد", "صیدون", "قلعه تل", "قلعه خواجه", "گتوند", "لالی", "مسجدسلیمان", "ملاثانی", "میانرود", "مینوشهر", "هفتگل", "هندیجان", "هویزه", "ویس"},
		"کرمانشاه":            {"کرمانشاه", "اسلام آباد غرب", "جوان رود", "کنگاور", "سرپل ذهاب", "باینگان", "بیستون", "پاوه", "تازه آباد", "حمیل", "ماهیدشت", "روانسر", "سرمست", "سطر", "سنقر", "سومار", "شاهو", "صحنه", "قصرشیرین", "کرندغرب", "کوزران", "گهواره", "گیلانغرب", "میان راهان", "نودشه", "نوسود", "هرسین", "هلشی"},
		"یزد":                 {"یزد", "اردکان", "میبد", "بافق", "حمیدیا", "ابرکوه", "احمدآباد", "اشکذر", "بفروئیه", "بهاباد", "تفت", "خضرآباد", "دیهوک", "زارچ", "شاهدیه", "عقدا", "مروست", "مهردشت", "مهریز", "ندوشن", "نیر", "هرات", "طبس"},
		"همدان":               {"همدان", "ملایر", "نهاوند", "اسدآباد", "تویسرکان", "بهار", "کبودر آهنگ", "ازندریان", "برزول", "جورقان", "جوکار", "دمق", "رزن", "زنگنه", "سامن", "سرکان", "شیرین سو", "صالح آباد", "فامنین", "فرسفج", "فیروزان", "قروه درجزین", "قهاوند", "گل تپه", "گیان", "لالجین", "مریانج"},
		"کردستان":             {"سنندج", "سقز", "مریوان", "بانه", "قروه", "کامیاران", "بیجار", "دیواندره", "دهگلان", "آرمرده", "بابارشانی", "بلبان آباد", "بوئین سفلی", "چناره", "دزج", "دلبران", "زرینه", "سروآباد", "سریش آباد", "شویشه", "صاحب", "کانی دینار", "کانی سور", "موچش", "یاسوکند"},
		"زنجان":               {"زنجان", "ابهر", "خرمدره", "قیدار", "حلب", "ارمغان خانه", "آب بر", "چورزق", "دندی", "زرین آباد", "زرین رود", "سجاس", "سلطانیه", "سهرورد", "صائین قلعه", "گرماب", "ماه نشان", "هیدج"},
		"استان قم":            {"قم", "جعفریه", "دستجرد", "سلفچگان", "قنوات", "کهک"},
		"البرز":               {"کرج", "فردیس", "کمال شهر", "نظرآباد", "ماهدشت", "مشکین دشت", "محمدشهر", "اسارا", "اشتهارد", "تنکمان", "چهارباغ", "سعید آباد", "شهر جدید هشتگرد", "طالقان", "کوهسار", "گرمدره", "هشتگرد", "تهران دشت", "کردان", "ساوجبلاغ"},
		"گلستان":              {"گرگان", "گنبدکاووس", "بندرترکمن", "علی آباد کتول", "آزادشهر", "کردکوی", "کلاله", "گالیکش", "مینودشت", "آق قلا", "انبارآلوم", "اینچه برون", "بندرگز", "جلین", "خان ببین", "دلند", "رامیان", "سرخنکلاته", "سیمین شهر", "فاضل آباد", "گمیش تپه", "مراوه", "نگین شهر", "نوده خاندوز", "نوکنده"},
		"سمنان":               {"سمنان", "شاهرود", "دامغان", "گرمسار", "میامی", "امیریه", "ایوانکی", "آرادان", "بسطام", "بیارجمند", "درجزین", "دیباج", "سرخه", "شهمیرزاد", "کلاته خیج", "مجن", "مهدی شهر"},
		"بوشهر":               {"بوشهر", "برازجان", "بندرگناوه", "بندرکنگان", "عسلویه", "اهرم", "امام حسن", "انارستان", "آب پخش", "آبدان", "بردخون", "بندردیر", "بندردیلم", "بندرریگ", "بنک", "تنگ ارم", "جم", "چغادک", "خارک", "خورموج", "دالکی", "دلوار", "ریز", "سعدآباد", "سیراف", "شبانکاره", "شنبه", "کاکی", "کلمه", "نخل تقی", "وحدتیه"},
		"هرمزگان":             {"بندرعباس", "کیش", "قشم", "بندرلنگه", "میناب", "حاجی آباد", "ابوموسی", "بستک", "بندرجاسک", "بندرچارک", "بندرخمیر", "بیکا", "پارسیان", "تخت", "جناح", "درگهان", "دهبارز", "رویدر", "زیارتعلی", "سردشت", "سندرک", "سوزا", "سیریک", "فارغان", "فین", "قلعه قاضی", "کنگ", "کوشکنار", "گوهران", "هرمز", "هشتبندی"},
		"سیستان و بلوچستان":   {"زاهدان", "زابل", "ایرانشهر", "سراوان", "چابهار", "خاش", "ادیمی", "اسپکه", "بزمان", "بمپور", "بنت", "بنجار", "پیشین", "جالق", "دوست محمد", "راسک", "زابلی", "زهک", "سرباز", "سوران", "سیرکان", "علی اکبر", "فنوج", "قصرقند", "کنارک", "گشت", "گلمورتی", "محمدان", "محمدآباد", "محمدی", "میرجاوه", "نصرت آباد", "نگور", "نوک آباد", "نیک شهر", "هیدوچ"},
		"کرمان":               {"کرمان", "سیرجان", "رفسنجان", "جیرفت", "زرند", "بم", "بافت", "بزنجان", "کهنوج", "اختیارآباد", "ارزوئیه", "امین شهر", "انار", "اندوهجرد", "باغین", "بردسیر", "بروات", "بهرمان", "مس سرچشمه", "پاریز", "جبالبارز", "جوپار", "جوزم", "چترود", "خاتون آباد", "خانوک", "خورسند", "درب بهشت", "دهج", "رابر", "راور", "راین", "رودبار", "ریحان شهر", "زنگی آباد", "زیدآباد", "شهداد", "شهربابک", "صفائیه", "عنبرآباد", "فاریاب", "فهرج", "قلعه گنج", "کاظم آباد", "کشکوئیه", "کوهبنان", "کیانشهر", "گلباف", "گلزار", "لاله زار", "ماهان", "محمدآباد", "محی آباد", "مردهک", "منوجان", "نجف شهر", "نرماشیر", "نظام شهر", "نگار", "نودژ", "هجدک", "یزدان شهر", "ازگله"},
		"لرستان":              {"خرم آباد", "بروجرد", "دورود", "کوهدشت", "نورآباد", "الیگودرز", "پلدختر", "ازنا", "اشترینان", "الشتر", "چالانچولان", "چغلوندی", "چقابل", "درب گنبد", "زاغه", "سپیددشت", "سراب دوره", "فیروزآباد", "کونانی", "گراب", "معمولان", "مومن آباد", "ویسیان"},
		"چهارمحال و بختیاری":  {"شهرکرد", "بروجن", "لردگان", "فرخ شهر", "فارسان", "اردل", "آلونی", "باباحیدر", "بلداجی", "بن", "جونقان", "چلگرد", "سامان", "سفیددشت", "سودجان", "سورشجان", "شلمزار", "طاقانک", "فرادنبه", "کیان", "گندمان", "گهرو", "مال خلیفه", "ناغان", "نافچ", "نقنه", "هفشجان"},
		"قزوین":               {"قزوین", "الوند", "محمدیه", "تاکستان", "آبیک", "ارداق", "اسفرورین", "اقبالیه", "آبگرم", "آوج", "بوئین زهرا", "بیدستان", "خاکعلی", "خرمدشت", "دانسفهان", "رازمیان", "سگزآباد", "سیردان", "شال", "شریفیه", "ضیاآباد", "کوهین", "محمودآباد نمونه", "معلم کلایه", "نرجه"},
		"اردبیل":              {"اردبیل", "پارس آباد", "مشگین شهر", "خلخال", "گرمی", "اصلاندوز", "آبی بیگلو", "بیله سوار", "تازه کند", "تازه کندانگوت", "جعفرآباد", "رضی", "سرعین", "عنبران", "فخرآباد", "کلور", "کوراییم", "گیوی", "لاهرود", "نمین", "نیر", "هشتجین", "هیر"},
		"کهگیلویه و بویراحمد": {"یاسوج", "دوگنبدان", "دهدشت", "باشت", "پاتاوه", "چرام", "چیتاب", "دیشموک", "سوق", "سی سخت", "قلعه رئیسی", "گراب سفلی", "لنده", "لیکک", "مادوان", "مارگون"},
		"ایلام":               {"ایلام", "ایوان", "دهلران", "آبدانان", "دره شهر", "ارکواز", "آسمان آباد", "بدره", "پهله", "توحید", "چوار", "دلگشا", "زرنه", "سراب باغ", "سرابله", "صالح آباد", "لومار", "مهران", "مورموری", "موسیان", "میمه"},
		"مرکزی":               {"اراک", "ساوه", "خمین", "محلات", "دلیجان", "آشتیان", "آستانه", "پرندک", "تفرش", "توره", "جاورسیان", "خشکرود", "خنداب", "داودآباد", "رازقان", "زاویه", "ساروق", "سنجان", "شازند", "غرق آباد", "فرمهین", "قورچی باشی", "کرهرود", "کمیجان", "مامونیه", "مهاجران", "میلاجرد", "نراق", "نوبران", "نیمور", "هندودر"},
	}

	// 3) ساخت استان‌ها
	provinceIDs := make(map[string]string, len(provinces))
	for pname := range provinces {
		prov := models.Location{ID: uuid.NewString(), Type: "STATE", Label: pname, ParentID: &iran.ID}

		var existed models.Location
		tx := db.Where("label = ? AND type = ? AND parentId = ?", prov.Label, prov.Type, iran.ID).First(&existed)
		if tx.Error == gorm.ErrRecordNotFound {
			if err := db.Create(&prov).Error; err != nil {
				log.Fatalf("create province %s: %v", pname, err)
			}
			provinceIDs[pname] = prov.ID
		} else if tx.Error != nil {
			log.Fatalf("find province %s: %v", pname, tx.Error)
		} else {
			provinceIDs[pname] = existed.ID
		}
	}

	// 4) ساخت شهرها
	for pname, cities := range provinces {
		pid := provinceIDs[pname]
		for _, cname := range cities {
			parent := pid
			city := models.Location{ID: uuid.NewString(), Type: "CITY", Label: cname, ParentID: &parent}

			var existed models.Location
			tx := db.Where("label = ? AND type = ? AND parentId = ?", city.Label, city.Type, parent).First(&existed)
			if tx.Error == gorm.ErrRecordNotFound {
				if err := db.Create(&city).Error; err != nil {
					log.Fatalf("create city %s/%s: %v", pname, cname, err)
				}
			} else if tx.Error != nil {
				log.Fatalf("find city %s/%s: %v", pname, cname, tx.Error)
			}
		}
	}

	log.Println("✅ Locations seeded (SQLite, UUID)")
}
